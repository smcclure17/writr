<!-- websockets.html -->
<!-- Temporary/HACK frontend for testing backend functionality-->
<pre id="output"></pre>
<div>
  <textarea
    id="area"
    oninput="send(this.value)"
    style="min-width: 600; min-height: 400"
  ></textarea>
</div>
<button onclick="save()">save</button>
<script>

  const input = document.getElementById("input");
  const output = document.getElementById("output");

  const socket = new WebSocket(`ws://localhost:8081/ws?document=doc-1`);

  socket.onopen = function () {
    output.innerHTML += "Status: Connected\n";
  };

  socket.onclose = function (event) {
    if (event.wasClean) {
      output.innerHTML +=
        "Status: Connection closed cleanly, code=" +
        event.code +
        " reason=" +
        event.reason +
        "\n";
    } else {
      output.innerHTML += "Status: Connection died\n";
    }
  };

  socket.onerror = function (error) {
    output.innerHTML += "Error: " + error + "\n";
  };

  socket.onmessage = function (e) {
    document.getElementById("area").value = e.data;
  };

  function send(val) {
    socket.send(val);
    val = "";
  }

  function save() {
    let text = document.getElementById("area").value;
    let endpoint = "http://localhost:8081/save";
    let data = { text: text };
    fetch(endpoint, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      form: JSON.stringify(data),
    })
      .then((res) => res.json())
      .then((data) => {
        console.log(data);
      });
  }
</script>
